<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glassmorphism Music Player SPA</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==========================================================================
           CSS VARIABLES & THEME
           ========================================================================== */
        :root {
            var(--primary): #00D9FF;
            --primary: #00D9FF;
            --primary-glow: rgba(0, 217, 255, 0.5);
            --secondary: #6B00FF;
            --secondary-glow: rgba(107, 0, 255, 0.5);
            --accent: #FF00FF;
            --accent-glow: rgba(255, 0, 255, 0.5);
            
            --bg-dark: #0A0015;
            --bg-light: #1A0A2E;
            
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-bg-hover: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-border-light: rgba(255, 255, 255, 0.25);
            
            --text-main: #FFFFFF;
            --text-muted: #A0A0B8;
            
            --sidebar-left-width: 240px;
            --sidebar-right-width: 280px;
            --player-height: 100px;
            --border-radius: 16px;
        }

        /* ==========================================================================
           GLOBAL STYLES
           ========================================================================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-main);
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-light) 100%);
            height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none;
        }
        #particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.02); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        .text-gradient {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Glassmorphism */
        .glass-panel {
            background: var(--glass-bg); backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid var(--glass-border); border-radius: var(--border-radius);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); transition: all 0.3s ease;
        }
        .glass-panel:hover {
            border-color: var(--glass-border-light);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4), 0 0 15px rgba(107, 0, 255, 0.15);
        }
        .glass-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-main); border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease; backdrop-filter: blur(5px);
        }
        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.15); transform: scale(1.05);
            border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow);
        }
        .mobile-menu-btn { display: none; } /* Hidden by default, shown on mobile */

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: var(--sidebar-left-width) 1fr var(--sidebar-right-width);
            grid-template-rows: calc(100vh - var(--player-height) - 40px);
            gap: 20px; padding: 20px; height: 100vh;
        }

        /* Sidebar Left */
        .sidebar-left { display: flex; flex-direction: column; padding: 24px; overflow-y: auto; }
        .logo { 
            display: flex; 
            align-items: center; 
            justify-content: flex-start;
            margin-bottom: 40px; 
            padding: 0 10px;
        }

        .app-logo { 
            max-width: 160px; /* Scales perfectly within the 240px sidebar */
            height: auto; 
            object-fit: contain;
            /* Adds a subtle cyan/magenta glow behind the logo to match the glassmorphism vibe */
            filter: drop-shadow(0 5px 15px rgba(0, 217, 255, 0.3)); 
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .app-logo:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 5px 20px rgba(255, 0, 255, 0.4));
        }

        .nav-menu { list-style: none; margin-bottom: 40px; }
        .nav-link {
            display: flex; align-items: center; gap: 16px; padding: 12px 16px;
            color: var(--text-muted); text-decoration: none; border-radius: 12px;
            transition: all 0.3s ease; font-weight: 500; margin-bottom: 8px;
        }
        .nav-link i { font-size: 18px; width: 20px; text-align: center; }
        .nav-link:hover, .nav-link.active {
            color: var(--text-main); background: var(--glass-bg-hover);
            box-shadow: inset 2px 0 0 var(--primary); text-shadow: 0 0 8px rgba(255,255,255,0.3);
        }
        .nav-link:hover i, .nav-link.active i { color: var(--primary); filter: drop-shadow(0 0 5px var(--primary-glow)); }

        .section-title { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom: 16px; padding-left: 16px; display: flex; justify-content: space-between; align-items: center;}
        .playlist-cards { display: flex; flex-direction: column; gap: 12px; }
        .playlist-card {
            display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 12px;
            background: rgba(255, 255, 255, 0.02); cursor: pointer; transition: all 0.3s ease;
        }
        .playlist-card:hover, .playlist-card.active {
            background: rgba(255, 255, 255, 0.08); transform: translateX(5px); border-left: 2px solid var(--accent);
        }
        .playlist-img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }

        /* Main Content Area */
        .main-content { display: flex; flex-direction: column; overflow-y: auto; border-radius: var(--border-radius); position: relative; scroll-behavior: smooth; }
        .top-bar {
            position: sticky; top: 0; display: flex; justify-content: space-between; align-items: center;
            padding: 20px 30px; background: linear-gradient(to bottom, rgba(10, 0, 21, 0.95), rgba(10, 0, 21, 0)); z-index: 100;
        }
        .nav-arrows { display: flex; gap: 12px; }
        .search-container { position: relative; width: 300px; }
        .search-container i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-input {
            width: 100%; padding: 12px 20px 12px 45px; border-radius: 20px; border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05); color: var(--text-main); outline: none; transition: all 0.3s ease;
        }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); background: rgba(255, 255, 255, 0.1); }
        .user-profile { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--secondary); object-fit: cover; cursor: pointer; }

        #view-container { padding: 0 30px 30px 30px; min-height: 100%; display: flex; flex-direction: column; }

        /* Views Common */
        .view-section { animation: slideUpFade 0.4s ease forwards; opacity: 0; }
        .view-header-large { font-size: 42px; font-weight: 700; margin-bottom: 24px; }

        /* Home View */
        .hero-card {
            display: flex; align-items: flex-end; padding: 40px; height: 280px; border-radius: 24px;
            background: linear-gradient(to right, rgba(0,0,0,0.7), rgba(0,0,0,0.2)), url('https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=1200&q=80') center/cover;
            position: relative; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.5); margin-bottom: 30px;
        }
        .hero-card::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, rgba(107,0,255,0.3), rgba(0,217,255,0.3)); pointer-events: none; }
        .hero-content { position: relative; z-index: 2; width: 100%; display: flex; justify-content: space-between; align-items: flex-end; }
        .hero-badge { display: inline-block; padding: 4px 12px; background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border-radius: 20px; font-size: 12px; font-weight: 600; margin-bottom: 12px; }
        .hero-title { font-size: 48px; font-weight: 700; margin-bottom: 8px; line-height: 1.1; }
        .btn-play-large {
            width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none; color: white; font-size: 24px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 0 20px var(--accent-glow); transition: all 0.3s ease;
        }
        .btn-play-large:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--accent-glow); }

        /* Grid System (Tracks & Albums) */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .track-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .track-card {
            padding: 16px; border-radius: 16px; background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease; cursor: pointer; position: relative;
        }
        .track-card:hover { background: rgba(255, 255, 255, 0.08); border-color: rgba(255, 255, 255, 0.2); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3), 0 0 15px rgba(0, 217, 255, 0.1); }
        .track-img-container { position: relative; width: 100%; aspect-ratio: 1; border-radius: 12px; overflow: hidden; margin-bottom: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
        .track-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
        .track-card:hover .track-img { transform: scale(1.05); }
        .track-play-overlay {
            position: absolute; bottom: 10px; right: 10px; width: 40px; height: 40px; background: var(--primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; font-size: 16px;
            opacity: 0; transform: translateY(10px); transition: all 0.3s ease; box-shadow: 0 0 15px var(--primary-glow);
        }
        .track-card:hover .track-play-overlay { opacity: 1; transform: translateY(0); }

        /* List View (Liked Songs & Playlists) */
        .header-banner { display: flex; gap: 30px; align-items: flex-end; padding-bottom: 30px; border-bottom: 1px solid var(--glass-border); margin-bottom: 30px; }
        .header-icon-box {
            width: 200px; height: 200px; border-radius: 16px; display: flex; align-items: center; justify-content: center;
            font-size: 80px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); object-fit: cover;
        }
        .bg-gradient-1 { background: linear-gradient(135deg, var(--secondary), var(--primary)); }
        .list-view-table { width: 100%; border-collapse: collapse; text-align: left; }
        .list-view-table th { color: var(--text-muted); font-size: 12px; text-transform: uppercase; padding: 10px 15px; border-bottom: 1px solid var(--glass-border); }
        .list-row { transition: all 0.2s; border-radius: 8px; cursor: pointer; }
        .list-row:hover { background: rgba(255,255,255,0.1); }
        .list-row td { padding: 12px 15px; vertical-align: middle; }
        .list-row td:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        .list-row td:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        .list-track-info { display: flex; align-items: center; gap: 12px; }
        .list-track-img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 0; color: var(--text-muted); text-align: center;}
        .empty-state i { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }

        /* Library & Tabs */
        .tabs-nav { display: flex; gap: 15px; margin-bottom: 30px; }
        .tab-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-main);
            padding: 10px 24px; border-radius: 30px; cursor: pointer; font-weight: 500; transition: all 0.3s ease;
        }
        .tab-btn.active, .tab-btn:hover { background: var(--primary); color: #000; border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); }

        /* Search Categories */
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .category-card {
            height: 160px; border-radius: 16px; padding: 20px; font-size: 24px; font-weight: 700; cursor: pointer;
            position: relative; overflow: hidden; transition: all 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .category-card:hover { transform: scale(1.03); }
        .category-card i { position: absolute; bottom: -10px; right: -10px; font-size: 80px; opacity: 0.3; transform: rotate(15deg); }

        /* Modal / Create Playlist */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: var(--bg-light); border: 1px solid var(--glass-border); border-radius: 20px;
            width: 500px; max-width: 90%; padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 14px; }
        .form-control {
            width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            border-radius: 8px; color: white; font-family: inherit; outline: none; transition: all 0.3s;
        }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
        .track-checkbox-list { max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; }
        .track-checkbox-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 6px; cursor: pointer; }
        .track-checkbox-item:hover { background: rgba(255,255,255,0.1); }
        .btn-primary { background: var(--primary); color: #000; border: none; padding: 12px 24px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--primary-glow); }

        /* Right Sidebar & Player Bar */
        .sidebar-right { display: flex; flex-direction: column; padding: 24px; overflow-y: auto; }
        .now-playing-large { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; text-align: center; }
        .npl-img-container {
            width: 200px; height: 200px; border-radius: 50%; margin-bottom: 20px; position: relative; padding: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            animation: spin 20s linear infinite; animation-play-state: paused; box-shadow: 0 0 30px rgba(107, 0, 255, 0.4);
        }
        .npl-img-container.playing { animation-play-state: running; }
        .npl-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--bg-dark); }
        
        .visualizer-mini { display: flex; gap: 4px; height: 30px; align-items: flex-end; margin-top: 15px; }
        .bar { width: 6px; background: linear-gradient(to top, var(--primary), var(--accent)); border-radius: 3px; height: 5px; transition: height 0.1s ease; }

        .queue-list { display: flex; flex-direction: column; gap: 10px; }
        .queue-item { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 12px; background: rgba(255,255,255,0.02); cursor: pointer; transition: all 0.2s; }
        .queue-item:hover { background: rgba(255,255,255,0.1); transform: scale(1.02); }
        .queue-item.active { background: rgba(0, 217, 255, 0.1); border: 1px solid rgba(0, 217, 255, 0.3); }
        .queue-item-img { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }

        /* Bottom Player Bar */
        .player-bar-wrapper { position: absolute; bottom: 20px; left: 20px; right: 20px; height: var(--player-height); z-index: 200;}
        .player-bar { width: 100%; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; }
        .player-left { width: 30%; display: flex; align-items: center; gap: 16px; }
        .current-track-img { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; border: 1px solid var(--glass-border); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .current-track-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
        .btn-like { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; transition: all 0.3s; }
        .btn-like:hover, .btn-like.liked { color: var(--accent); filter: drop-shadow(0 0 8px var(--accent-glow)); transform: scale(1.2); }
        
        .player-center { width: 40%; display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .player-controls { display: flex; align-items: center; gap: 20px; }
        .control-btn { background: none; border: none; color: var(--text-muted); font-size: 16px; cursor: pointer; transition: all 0.2s; }
        .control-btn:hover { color: var(--text-main); transform: scale(1.1); }
        .control-btn.active { color: var(--primary); filter: drop-shadow(0 0 5px var(--primary-glow)); }
        .play-pause-btn {
            width: 46px; height: 46px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; font-size: 18px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease;
        }
        .play-pause-btn:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--accent-glow); }
        
        .progress-container { width: 100%; display: flex; align-items: center; gap: 12px; font-size: 12px; color: var(--text-muted); }
        .custom-slider { flex: 1; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; position: relative; cursor: pointer; }
        .slider-fill { position: absolute; top: 0; left: 0; height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 4px; width: 0%; pointer-events: none; box-shadow: 0 0 10px var(--primary-glow); }
        .slider-thumb { position: absolute; top: 50%; left: 0%; width: 14px; height: 14px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .custom-slider:hover .slider-thumb { opacity: 1; }
        
        .player-right { width: 30%; display: flex; align-items: center; justify-content: flex-end; gap: 16px; }
        .volume-container { display: flex; align-items: center; gap: 10px; width: 120px; }

        /* Toasts */
        .toast-container { position: fixed; bottom: 140px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast {
            background: rgba(10, 0, 21, 0.9); backdrop-filter: blur(10px); border: 1px solid var(--primary); color: white;
            padding: 12px 24px; border-radius: 30px; font-size: 14px; font-weight: 500; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), 0 0 10px var(--primary-glow);
            animation: slideUpFade 0.3s ease forwards, fadeOut 0.3s ease 2.7s forwards;
        }

        /* Animations */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container { grid-template-columns: var(--sidebar-left-width) 1fr; }
            .sidebar-right { display: none; }
            .player-right { width: 20%; } .player-center { width: 50%; }
        }

        /* --- MOBILE ADJUSTMENTS (STRICTLY RESPONSIVE UI) --- */
        @media (max-width: 768px) {
            .app-container { 
                grid-template-columns: 1fr; 
                padding: 10px;
                gap: 10px;
                grid-template-rows: calc(100vh - 140px); /* Adjust for mobile bottom player */
            }
            
            /* Sidebar becomes mobile sliding menu */
            .sidebar-left { 
                display: flex; /* Override display: none */
                position: fixed;
                top: 0;
                left: -100%; /* Hidden by default */
                width: 280px;
                height: 100vh;
                z-index: 9999;
                background: rgba(10, 0, 21, 0.98);
                transition: left 0.3s ease;
                box-shadow: 10px 0 30px rgba(0,0,0,0.8);
                padding: 20px;
            }
            .sidebar-left.show-mobile { left: 0; }
            
            /* Top Navigation Bar Adjustments */
            .mobile-menu-btn { display: flex !important; }
            .nav-arrows .glass-btn:not(.mobile-menu-btn) { display: none; } /* Hide back/forward to save search bar space */
            .top-bar { padding: 10px 15px; }
            .search-container { width: 100%; max-width: none; flex: 1; margin: 0 10px; }
            .search-input { padding: 10px 15px 10px 35px; font-size: 14px; }
            .user-profile { width: 32px; height: 32px; }

            /* Main Content Container */
            #view-container { padding: 0 15px 20px 15px; }

            /* Bottom Player Mobile Layout */
            .player-bar-wrapper { 
                height: 120px; 
                bottom: 10px; left: 10px; right: 10px; 
            }
            .player-bar { 
                flex-direction: column; 
                padding: 10px 15px; 
                justify-content: space-between;
                gap: 5px;
            }
            .player-left { width: 100%; justify-content: flex-start; }
            .current-track-img { width: 45px; height: 45px; }
            .current-track-title { font-size: 14px; margin-bottom: 0; }
            #player-artist, #player-copyright { font-size: 10px; }
            .btn-like { margin-left: auto; }
            
            .player-center { width: 100%; }
            .player-controls { gap: 15px; }
            .play-pause-btn { width: 40px; height: 40px; font-size: 16px; }
            .control-btn { font-size: 14px; }
            .progress-container { font-size: 10px; gap: 8px; margin-top: 5px; }
            .player-right { display: none; }
            
            /* View-specific element scaling */
            .hero-card { height: auto; min-height: 220px; padding: 20px; margin-bottom: 20px; flex-direction: column; align-items: flex-start; justify-content: flex-end;}
            .hero-content { flex-direction: column; align-items: flex-start; gap: 15px; }
            .hero-title { font-size: 32px; margin-bottom: 5px; }
            .btn-play-large { position: absolute; bottom: 20px; right: 20px; width: 50px; height: 50px; font-size: 20px;}
            
            .header-banner { flex-direction: column; align-items: center; text-align: center; gap: 15px; }
            .header-icon-box { width: 160px; height: 160px; font-size: 60px; }
            .view-header-large { font-size: 32px !important; }

            .track-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
            .track-card { padding: 12px; }
            
            .list-view-table th:nth-child(3), .list-row td:nth-child(3) { display: none; }
            .list-row td { padding: 10px; }
            
            .category-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
            .category-card { height: 120px; font-size: 18px; padding: 15px; }
            .category-card i { font-size: 60px; }

            .modal-content { width: 95%; padding: 20px; }
            .toast-container { bottom: 140px; width: 90%; text-align: center; }
        }
    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <div class="app-container">
        <!-- Sidebar Left -->
        <aside class="sidebar-left glass-panel">
           <div class="logo">
                <!-- Replace 'loomix-logo.png' with the actual filename of your saved image -->
                <img src="logo.png" alt="Loomix" class="app-logo">
            </div>

            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active" data-nav="home"><i class="fa-solid fa-house"></i> Home</a></li>
                <li><a href="#search" class="nav-link" data-nav="search"><i class="fa-solid fa-magnifying-glass"></i> Search</a></li>
                <li><a href="#library" class="nav-link" data-nav="library"><i class="fa-solid fa-book-open"></i> Your Library</a></li>
                <li style="margin-top: 20px;"><a href="#" onclick="app.openCreatePlaylistModal(); return false;" class="nav-link"><i class="fa-solid fa-square-plus"></i> Create Playlist</a></li>
                <li><a href="#liked" class="nav-link" data-nav="liked"><i class="fa-solid fa-heart" style="color: var(--accent);"></i> Liked Songs</a></li>
            </ul>

            <div class="section-title">Playlists</div>
            <div class="playlist-cards" id="sidebar-playlists">
                <!-- Dynamically injected -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content glass-panel" id="main-scroll">
            <div class="top-bar">
                <div class="nav-arrows">
                    <!-- Added Hamburger button for Mobile -->
                    <button class="glass-btn mobile-menu-btn" style="width: 36px; height: 36px;" onclick="document.querySelector('.sidebar-left').classList.toggle('show-mobile')"><i class="fa-solid fa-bars"></i></button>
                    <button class="glass-btn" style="width: 36px; height: 36px;" onclick="history.back()"><i class="fa-solid fa-chevron-left"></i></button>
                    <button class="glass-btn" style="width: 36px; height: 36px;" onclick="history.forward()"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="search-container">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" class="search-input" id="global-search" placeholder="Search artists, songs, or podcasts...">
                </div>
                <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100&q=80" alt="Profile" class="user-profile">
            </div>

            <!-- Dynamic View Container -->
            <div id="view-container"></div>
        </main>

        <!-- Sidebar Right -->
        <aside class="sidebar-right glass-panel">
            <div class="now-playing-large">
                <h3 style="margin-bottom: 20px; font-size: 16px; width: 100%; text-align: left;">Now Playing</h3>
                <div class="npl-img-container" id="spin-record">
                    <img src="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&q=80" alt="Current" class="npl-img" id="npl-img">
                </div>
                <h2 class="track-title text-gradient truncate" id="npl-title" style="font-size: 20px; margin-top: 10px; width: 100%;">Welcome</h2>
                <p class="track-artist truncate" id="npl-artist" style="font-size: 14px; width: 100%;">GlassBeat</p>
                <div class="visualizer-mini" id="mini-visualizer">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    <div class="bar"></div><div class="bar"></div>
                </div>
            </div>

            <div class="queue-container">
                <div class="section-title" style="padding:0; margin-bottom:16px;">
                    <span>Next in Queue</span>
                    <i class="fa-solid fa-list"></i>
                </div>
                <div class="queue-list" id="queue-list"></div>
            </div>
        </aside>
    </div>

    <!-- Create Playlist Modal -->
    <div class="modal-overlay" id="create-playlist-modal">
        <div class="modal-content">
            <h2 class="view-header-large" style="font-size: 28px; margin-bottom: 20px;">Create Playlist</h2>
            <div class="form-group">
                <label>Playlist Name</label>
                <input type="text" id="cp-name" class="form-control" placeholder="My Awesome Mix">
            </div>
            <div class="form-group">
                <label>Select Tracks</label>
                <div class="track-checkbox-list" id="cp-tracks">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px;">
                <button class="btn-primary" style="background: transparent; border: 1px solid var(--glass-border); color: white;" onclick="app.closeCreatePlaylistModal()">Cancel</button>
                <button class="btn-primary" onclick="app.saveNewPlaylist()">Create</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Bottom Player Bar -->
    <div class="player-bar-wrapper">
        <div class="player-bar glass-panel">
            <div class="player-left">
                <img src="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=100&q=80" class="current-track-img" id="player-img" alt="cover">
                <div style="display: flex; flex-direction: column; min-width: 0;">
                <div class="current-track-title truncate text-gradient" id="player-title">Welcome</div>
                <div class="truncate" id="player-artist" style="font-size: 12px; color: var(--text-muted);">Select a track</div>
                <!-- This is the new Copyright Line -->
                <div class="truncate" id="player-copyright" style="font-size: 10px; color: var(--secondary); margin-top: 2px;">© Loomix</div>
            </div>
    <button class="btn-like" id="btn-like" onclick="app.toggleLike()"><i class="fa-regular fa-heart" id="like-icon"></i></button>
</div>
            <div class="player-center">
                <div class="player-controls">
                    <button class="control-btn" id="btn-shuffle" onclick="app.toggleShuffle()"><i class="fa-solid fa-shuffle"></i></button>
                    <button class="control-btn" onclick="app.prevTrack()"><i class="fa-solid fa-backward-step"></i></button>
                    <button class="play-pause-btn" id="btn-play" onclick="app.togglePlay()"><i class="fa-solid fa-play" id="play-icon" style="margin-left: 4px;"></i></button>
                    <button class="control-btn" onclick="app.nextTrack()"><i class="fa-solid fa-forward-step"></i></button>
                    <button class="control-btn" id="btn-repeat" onclick="app.toggleRepeat()"><i class="fa-solid fa-repeat"></i></button>
                </div>
                <div class="progress-container">
                    <span id="time-current">0:00</span>
                    <div class="custom-slider" id="progress-slider">
                        <div class="slider-fill" id="progress-fill"></div>
                        <div class="slider-thumb" id="progress-thumb"></div>
                    </div>
                    <span id="time-total">0:00</span>
                </div>
            </div>
            <div class="player-right">
                <div class="volume-container">
                    <button class="control-btn" onclick="app.toggleMute()" style="width: 20px;"><i class="fa-solid fa-volume-high" id="volume-icon"></i></button>
                    <div class="custom-slider" id="volume-slider">
                        <div class="slider-fill" id="volume-fill" style="width: 100%;"></div>
                        <div class="slider-thumb" id="volume-thumb" style="left: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Script -->
    <script>
        // --- DATA ---
        const TRACKS = [
            { id: 1, title: "Neon Horizon", artist: "Synthwave Boy", album: "Retro Future", genre: "Electronic", year: 2024, duration: 245, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { id: 2, title: "Electric Dreams", artist: "Luna Moon", album: "Night Drive", genre: "Pop", year: 2023, duration: 198, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { id: 3, title: "Midnight Cruise", artist: "The Midnight", album: "Nocturnal", genre: "Synthwave", year: 2022, duration: 312, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1493225457124-a1a2a5956093?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { id: 4, title: "Cosmic Rain", artist: "Astro", album: "Space Tape", genre: "Lo-Fi", year: 2024, duration: 185, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
            { id: 5, title: "City Lights", artist: "Urban Beats", album: "Metropolis", genre: "Hip-Hop", year: 2021, duration: 210, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1459749411175-04bf5292ceea?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" },
            { id: 6, title: "Deep Ocean", artist: "Wave Maker", album: "Abyss", genre: "Ambient", year: 2023, duration: 275, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1508700115892-45ecd05ae2ad?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3" },
            { id: 7, title: "Sunset Boulevard", artist: "Cali Kids", album: "West Coast", genre: "Rock", year: 2020, duration: 230, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" },
            { id: 8, title: "Cyberpunk 2077", artist: "Net Runner", album: "Glitch", genre: "Electronic", year: 2024, duration: 195, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1518609878373-06d740f60d8b?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
            { id: 9, title: "Acoustic Morning", artist: "Coffee House", album: "Unplugged", genre: "Acoustic", year: 2019, duration: 215, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1498038432885-c6f3f1b912ee?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" },
            { id: 10, title: "Lofi Study", artist: "Chill Girl", album: "Beats to Study", genre: "Lo-Fi", year: 2025, duration: 160, copyright: "© 2026 Loomix Records", cover: "https://images.unsplash.com/photo-1458560871784-56d23406c091?w=300&q=80", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" }
        ];

        const CATEGORIES = [
            { name: "Pop", color: "linear-gradient(135deg, #FF00FF, #FF7F50)", icon: "fa-microphone" },
            { name: "Electronic", color: "linear-gradient(135deg, #00D9FF, #6B00FF)", icon: "fa-bolt" },
            { name: "Hip-Hop", color: "linear-gradient(135deg, #FF4500, #8B0000)", icon: "fa-fire" },
            { name: "Rock", color: "linear-gradient(135deg, #2E8B57, #000000)", icon: "fa-guitar" },
            { name: "Lo-Fi", color: "linear-gradient(135deg, #9370DB, #FFB6C1)", icon: "fa-coffee" },
            { name: "Ambient", color: "linear-gradient(135deg, #4682B4, #000080)", icon: "fa-water" },
            { name: "Synthwave", color: "linear-gradient(135deg, #8A2BE2, #FF1493)", icon: "fa-vr-cardboard" },
            { name: "Acoustic", color: "linear-gradient(135deg, #D2B48C, #8B4513)", icon: "fa-leaf" }
        ];

        // --- APP CLASS ---
        class MusicPlayerSPA {
            constructor() {
                // State
                this.audio = new Audio();
                this.tracks = TRACKS;
                this.queue = [...TRACKS];
                this.originalQueue = [...TRACKS];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.isShuffle = false;
                this.repeatMode = 0;
                this.volume = 1;
                
                // Persistence
                this.likedSongs = JSON.parse(localStorage.getItem('glassBeatLiked')) || [];
                this.playlists = JSON.parse(localStorage.getItem('glassBeatPlaylists')) || [
                    { id: 'p1', name: "Synthwave Vibes", tracks: [1,3,8], cover: "https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=300&q=80" },
                    { id: 'p2', name: "Chill Lo-Fi", tracks: [4,10], cover: "https://images.unsplash.com/photo-1493225457124-a1a2a5956093?w=300&q=80" }
                ];
                
                this.cacheDOM();
                this.init();
            }

            cacheDOM() {
                this.viewContainer = document.getElementById('view-container');
                this.sidebarPlaylists = document.getElementById('sidebar-playlists');
                this.searchInput = document.getElementById('global-search');
                this.queueList = document.getElementById('queue-list');
                
                // Player Controls
                this.btnPlay = document.getElementById('btn-play');
                this.playIcon = document.getElementById('play-icon');
                this.btnLike = document.getElementById('btn-like');
                this.likeIcon = document.getElementById('like-icon');
                this.progSlider = document.getElementById('progress-slider');
                this.volSlider = document.getElementById('volume-slider');
                
                this.visAnimationId = null;
            }

            init() {
                this.loadSettings();
                this.setupEventListeners();
                this.renderSidebarPlaylists();
                this.loadTrack(0, false);
                
                // Init Routing
                window.addEventListener('hashchange', () => this.handleRoute());
                if (!window.location.hash) window.location.hash = 'home';
                else this.handleRoute();
            }

            // --- ROUTING & VIEWS ---
            handleRoute() {
                const hash = window.location.hash.slice(1);
                const [route, id] = hash.split('/');
                
                // Close mobile menu if opened (strictly related to mobile UI)
                const sidebar = document.querySelector('.sidebar-left');
                if (sidebar) sidebar.classList.remove('show-mobile');
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`.nav-link[data-nav="${route}"]`);
                if(activeLink) activeLink.classList.add('active');
                else if(route === 'playlist') {
                    // Highlight playlist in sidebar
                    document.querySelectorAll('.playlist-card').forEach(c => c.classList.remove('active'));
                    const pc = document.getElementById(`side-pl-${id}`);
                    if(pc) pc.classList.add('active');
                }

                // Scroll top
                document.getElementById('main-scroll').scrollTo(0,0);
                
                // Render View
                this.viewContainer.innerHTML = ''; // Clear container
                const wrapper = document.createElement('div');
                wrapper.className = 'view-section';
                
                switch(route) {
                    case 'home': this.renderHome(wrapper); break;
                    case 'search': this.renderSearch(wrapper, this.searchInput.value); break;
                    case 'library': this.renderLibrary(wrapper); break;
                    case 'liked': this.renderLiked(wrapper); break;
                    case 'playlist': this.renderPlaylist(wrapper, id); break;
                    default: this.renderHome(wrapper);
                }
                
                this.viewContainer.appendChild(wrapper);
            }

            // 1. HOME VIEW
            renderHome(container) {
                container.innerHTML = `
                    <div class="hero-card">
                        <div class="hero-content">
                            <div>
                                <span class="hero-badge">Featured Mix</span>
                                <h1 class="hero-title text-gradient">GlassBeat <br>Essentials</h1>
                                <p style="color: rgba(255,255,255,0.8); font-size: 14px;">10 Songs • Best of the week</p>
                            </div>
                            <button class="btn-play-large" onclick="app.playContext(app.tracks, 0)">
                                <i class="fa-solid fa-play" style="margin-left: 4px;"></i>
                            </button>
                        </div>
                    </div>
                    <div class="section-header"><h2>Recommended for you</h2></div>
                    <div class="track-grid" id="home-grid"></div>
                `;
                const grid = container.querySelector('#home-grid');
                this.tracks.forEach((t, i) => grid.appendChild(this.createGridCard(t, i, this.tracks)));
            }

            // 2. SEARCH VIEW
            renderSearch(container, query = '') {
                container.innerHTML = `
                    <h1 class="view-header-large text-gradient">Search</h1>
                    ${query ? '' : '<div class="section-header"><h2>Browse All</h2></div>'}
                    <div id="search-content"></div>
                `;
                
                const content = container.querySelector('#search-content');
                if (query) {
                    const q = query.toLowerCase();
                    const results = this.tracks.filter(t => 
                        t.title.toLowerCase().includes(q) || t.artist.toLowerCase().includes(q) || t.album.toLowerCase().includes(q)
                    );
                    if (results.length > 0) {
                        content.innerHTML = `<div class="track-grid" id="search-grid"></div>`;
                        const grid = content.querySelector('#search-grid');
                        results.forEach((t, i) => grid.appendChild(this.createGridCard(t, i, results)));
                    } else {
                        content.innerHTML = `<div class="empty-state"><i class="fa-solid fa-search"></i><h2>No results found for "${query}"</h2></div>`;
                    }
                } else {
                    content.innerHTML = `<div class="category-grid" id="cat-grid"></div>`;
                    const grid = content.querySelector('#cat-grid');
                    CATEGORIES.forEach(c => {
                        const div = document.createElement('div');
                        div.className = 'category-card';
                        div.style.background = c.color;
                        div.innerHTML = `<span>${c.name}</span><i class="fa-solid ${c.icon}"></i>`;
                        div.onclick = () => {
                            this.searchInput.value = c.name;
                            this.renderSearch(container, c.name);
                        };
                        grid.appendChild(div);
                    });
                }
            }

            // 3. LIBRARY VIEW
            renderLibrary(container) {
                container.innerHTML = `
                    <h1 class="view-header-large text-gradient">Your Library</h1>
                    <div class="tabs-nav">
                        <button class="tab-btn active" id="tab-pl">Playlists</button>
                        <button class="tab-btn" id="tab-art">Artists</button>
                    </div>
                    <div id="lib-content"></div>
                `;
                const content = container.querySelector('#lib-content');
                const btnPl = container.querySelector('#tab-pl');
                const btnArt = container.querySelector('#tab-art');

                const renderPl = () => {
                    btnPl.classList.add('active'); btnArt.classList.remove('active');
                    content.innerHTML = `<div class="track-grid" id="lib-grid"></div>`;
                    const grid = content.querySelector('#lib-grid');
                    this.playlists.forEach(p => {
                        const card = document.createElement('div');
                        card.className = 'track-card';
                        card.onclick = () => window.location.hash = `playlist/${p.id}`;
                        card.innerHTML = `
                            <div class="track-img-container"><img src="${p.cover}" class="track-img"></div>
                            <div class="track-title truncate">${p.name}</div>
                            <div class="track-artist truncate">${p.tracks.length} tracks</div>
                        `;
                        grid.appendChild(card);
                    });
                };

                const renderArt = () => {
                    btnArt.classList.add('active'); btnPl.classList.remove('active');
                    const artists = [...new Set(this.tracks.map(t => t.artist))];
                    content.innerHTML = `<div class="track-grid" id="lib-grid"></div>`;
                    const grid = content.querySelector('#lib-grid');
                    artists.forEach(a => {
                        const card = document.createElement('div');
                        card.className = 'track-card';
                        card.onclick = () => { this.searchInput.value = a; window.location.hash = 'search'; };
                        card.innerHTML = `
                            <div class="track-img-container" style="border-radius: 50%;"><img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=300&q=80" class="track-img" style="border-radius: 50%;"></div>
                            <div class="track-title truncate" style="text-align: center;">${a}</div>
                            <div class="track-artist truncate" style="text-align: center;">Artist</div>
                        `;
                        grid.appendChild(card);
                    });
                };

                btnPl.onclick = renderPl;
                btnArt.onclick = renderArt;
                renderPl(); // Default
            }

            // 4. LIKED SONGS VIEW
            renderLiked(container) {
                const likedTracks = this.likedSongs.map(id => this.tracks.find(t => t.id === id)).filter(Boolean);
                
                container.innerHTML = `
                    <div class="header-banner">
                        <div class="header-icon-box bg-gradient-1"><i class="fa-solid fa-heart" style="color:white;"></i></div>
                        <div>
                            <span style="font-size: 12px; font-weight: 600;">PLAYLIST</span>
                            <h1 class="view-header-large text-gradient" style="margin-bottom: 10px; font-size: 56px;">Liked Songs</h1>
                            <p style="color: var(--text-muted);">${likedTracks.length} songs</p>
                            ${likedTracks.length > 0 ? `<button class="btn-play-large" style="margin-top: 20px;" onclick="app.playContext(app.likedSongs.map(id => app.tracks.find(t=>t.id===id)), 0)"><i class="fa-solid fa-play" style="margin-left: 4px;"></i></button>` : ''}
                        </div>
                    </div>
                    <div id="liked-list"></div>
                `;
                
                const listContainer = container.querySelector('#liked-list');
                if (likedTracks.length === 0) {
                    listContainer.innerHTML = `<div class="empty-state"><i class="fa-regular fa-heart"></i><h2>No liked songs yet</h2><p>Songs you like will appear here</p></div>`;
                } else {
                    listContainer.appendChild(this.createListView(likedTracks));
                }
            }

            // 5. PLAYLIST DETAIL VIEW
            renderPlaylist(container, id) {
                const p = this.playlists.find(p => p.id === id);
                if(!p) return;
                const pTracks = p.tracks.map(tid => this.tracks.find(t => t.id === tid)).filter(Boolean);
                
                container.innerHTML = `
                    <div class="header-banner">
                        <img src="${p.cover}" class="header-icon-box">
                        <div>
                            <span style="font-size: 12px; font-weight: 600;">PLAYLIST</span>
                            <h1 class="view-header-large text-gradient" style="margin-bottom: 10px; font-size: 56px;">${p.name}</h1>
                            <p style="color: var(--text-muted);">${pTracks.length} songs</p>
                            ${pTracks.length > 0 ? `<button class="btn-play-large" style="margin-top: 20px;" onclick="app.playContext(app.playlists.find(pl=>pl.id==='${id}').tracks.map(tid => app.tracks.find(t=>t.id===tid)), 0)"><i class="fa-solid fa-play" style="margin-left: 4px;"></i></button>` : ''}
                        </div>
                    </div>
                    <div id="pl-list"></div>
                `;
                
                const listContainer = container.querySelector('#pl-list');
                if (pTracks.length === 0) listContainer.innerHTML = `<div class="empty-state"><i class="fa-solid fa-music"></i><h2>Empty Playlist</h2></div>`;
                else listContainer.appendChild(this.createListView(pTracks));
            }

            // --- UI HELPERS ---
            
            createGridCard(track, index, contextArray) {
                const card = document.createElement('div');
                card.className = `track-card`;
                card.onclick = () => this.playContext(contextArray, index);
                card.innerHTML = `
                    <div class="track-img-container">
                        <img src="${track.cover}" class="track-img">
                        <div class="track-play-overlay"><i class="fa-solid fa-play" style="margin-left: 3px;"></i></div>
                    </div>
                    <div class="track-title truncate">${track.title}</div>
                    <div class="track-artist truncate">${track.artist}</div>
                `;
                return card;
            }

            createListView(trackArray) {
                const table = document.createElement('table');
                table.className = 'list-view-table';
                table.innerHTML = `<tr><th>#</th><th>Title</th><th>Album</th><th><i class="fa-regular fa-clock"></i></th></tr>`;
                
                trackArray.forEach((t, i) => {
                    const tr = document.createElement('tr');
                    tr.className = 'list-row';
                    tr.onclick = () => this.playContext(trackArray, i);
                    tr.innerHTML = `
                        <td>${i + 1}</td>
                        <td>
                            <div class="list-track-info">
                                <img src="${t.cover}" class="list-track-img">
                                <div style="min-width: 0;">
                                    <div class="track-title truncate" ${this.queue[this.currentIndex]?.id === t.id ? 'style="color: var(--primary);"' : ''}>${t.title}</div>
                                    <div class="track-artist truncate">${t.artist}</div>
                                </div>
                            </div>
                        </td>
                        <td class="truncate" style="color: var(--text-muted); max-width: 200px;">${t.album}</td>
                        <td style="color: var(--text-muted);">${this.formatTime(t.duration)}</td>
                    `;
                    table.appendChild(tr);
                });
                return table;
            }

            renderSidebarPlaylists() {
                this.sidebarPlaylists.innerHTML = '';
                this.playlists.forEach(p => {
                    const el = document.createElement('div');
                    el.className = 'playlist-card';
                    el.id = `side-pl-${p.id}`;
                    el.onclick = () => window.location.hash = `playlist/${p.id}`;
                    el.innerHTML = `
                        <img src="${p.cover}" class="playlist-img">
                        <div class="truncate">
                            <div style="font-size: 14px; font-weight: 500;">${p.name}</div>
                            <div style="font-size: 11px; color: var(--text-muted);">${p.tracks.length} tracks</div>
                        </div>
                    `;
                    this.sidebarPlaylists.appendChild(el);
                });
            }

            // --- PLAYLIST CREATION ---
            openCreatePlaylistModal() {
                const modal = document.getElementById('create-playlist-modal');
                const tracksContainer = document.getElementById('cp-tracks');
                tracksContainer.innerHTML = '';
                
                this.tracks.forEach(t => {
                    const div = document.createElement('div');
                    div.className = 'track-checkbox-item';
                    div.innerHTML = `
                        <input type="checkbox" id="chk-${t.id}" value="${t.id}" style="accent-color: var(--primary);">
                        <label for="chk-${t.id}" style="color: white; margin:0; cursor:pointer;" class="truncate">${t.title} - ${t.artist}</label>
                    `;
                    tracksContainer.appendChild(div);
                });
                
                document.getElementById('cp-name').value = '';
                modal.classList.add('active');
            }

            closeCreatePlaylistModal() {
                document.getElementById('create-playlist-modal').classList.remove('active');
            }

            saveNewPlaylist() {
                const name = document.getElementById('cp-name').value || "New Playlist";
                const checkboxes = document.querySelectorAll('#cp-tracks input:checked');
                const selectedIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
                
                const newPl = {
                    id: Date.now().toString(),
                    name: name,
                    tracks: selectedIds,
                    cover: "https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=300&q=80" // default gradient
                };
                
                this.playlists.push(newPl);
                localStorage.setItem('glassBeatPlaylists', JSON.stringify(this.playlists));
                this.renderSidebarPlaylists();
                this.closeCreatePlaylistModal();
                this.showToast(`Playlist "${name}" created!`);
                window.location.hash = `playlist/${newPl.id}`;
            }

            // --- AUDIO ENGINE ---
            playContext(trackArray, startIndex) {
                if(!trackArray || trackArray.length === 0) return;
                this.queue = [...trackArray];
                this.originalQueue = [...trackArray];
                this.isShuffle = false;
                document.getElementById('btn-shuffle').classList.remove('active');
                this.playTrack(startIndex);
            }

            loadTrack(index, autoPlay = true) {
                this.currentIndex = index;
                const track = this.queue[this.currentIndex];
                if(!track) return;
                
                this.audio.src = track.url;
                this.audio.load();
                
                // Add this under the player-artist line inside loadTrack()
                document.getElementById('player-copyright').textContent = track.copyright || "© Loomix";
                // Update Player Bar
                document.getElementById('player-title').textContent = track.title;
                document.getElementById('player-artist').textContent = track.artist;
                document.getElementById('player-img').src = track.cover;
                
                // Update Right Sidebar
                document.getElementById('npl-title').textContent = track.title;
                document.getElementById('npl-artist').textContent = track.artist;
                document.getElementById('npl-img').src = track.cover;
                
                // Likes
                if(this.likedSongs.includes(track.id)) {
                    this.btnLike.classList.add('liked');
                    this.likeIcon.classList.replace('fa-regular', 'fa-solid');
                } else {
                    this.btnLike.classList.remove('liked');
                    this.likeIcon.classList.replace('fa-solid', 'fa-regular');
                }
                
                this.renderQueueList();
                
                // Visual refresh if in list view
                if(window.location.hash === '#liked' || window.location.hash.startsWith('#playlist')) {
                    this.handleRoute(); 
                }
                
                if (autoPlay) this.play();
                else this.pause();
            }

            playTrack(index) { this.loadTrack(index, true); }

            togglePlay() { this.audio.src ? (this.isPlaying ? this.pause() : this.play()) : null; }

            play() {
                this.audio.play().then(() => {
                    this.isPlaying = true;
                    this.playIcon.classList.replace('fa-play', 'fa-pause');
                    this.btnPlay.style.boxShadow = "0 0 25px var(--primary-glow)";
                    document.getElementById('spin-record').classList.add('playing');
                    this.startVisualizer();
                }).catch(e => { console.error(e); this.showToast("Playback error"); });
            }

            pause() {
                this.audio.pause();
                this.isPlaying = false;
                this.playIcon.classList.replace('fa-pause', 'fa-play');
                this.btnPlay.style.boxShadow = "0 4px 15px rgba(0, 0, 0, 0.3)";
                document.getElementById('spin-record').classList.remove('playing');
                this.stopVisualizer();
            }

            nextTrack() {
                let next = this.currentIndex + 1;
                if (next >= this.queue.length) {
                    if (this.repeatMode === 1) next = 0; else { this.pause(); return; }
                }
                this.playTrack(next);
            }

            prevTrack() {
                if (this.audio.currentTime > 3) this.audio.currentTime = 0;
                else {
                    let prev = this.currentIndex - 1;
                    if (prev < 0) prev = this.queue.length - 1;
                    this.playTrack(prev);
                }
            }

            toggleShuffle() {
                this.isShuffle = !this.isShuffle;
                const current = this.queue[this.currentIndex];
                const btn = document.getElementById('btn-shuffle');
                
                if (this.isShuffle) {
                    btn.classList.add('active');
                    let rem = this.queue.filter((_, i) => i !== this.currentIndex).sort(() => Math.random() - 0.5);
                    this.queue = [current, ...rem];
                    this.currentIndex = 0;
                    this.showToast("Shuffle On");
                } else {
                    btn.classList.remove('active');
                    this.queue = [...this.originalQueue];
                    this.currentIndex = this.queue.findIndex(t => t.id === current.id);
                    this.showToast("Shuffle Off");
                }
                this.renderQueueList();
            }

            toggleRepeat() {
                this.repeatMode = (this.repeatMode + 1) % 3;
                const btn = document.getElementById('btn-repeat');
                if (this.repeatMode === 0) { btn.classList.remove('active'); btn.innerHTML = '<i class="fa-solid fa-repeat"></i>'; this.audio.loop = false; this.showToast("Repeat Off");}
                else if (this.repeatMode === 1) { btn.classList.add('active'); btn.innerHTML = '<i class="fa-solid fa-repeat"></i>'; this.audio.loop = false; this.showToast("Repeat All");}
                else { btn.classList.add('active'); btn.innerHTML = '<i class="fa-solid fa-repeat-1"></i>'; this.audio.loop = true; this.showToast("Repeat One");}
            }

            toggleLike() {
                const track = this.queue[this.currentIndex];
                if(!track) return;
                const idx = this.likedSongs.indexOf(track.id);
                if (idx > -1) {
                    this.likedSongs.splice(idx, 1);
                    this.btnLike.classList.remove('liked'); this.likeIcon.classList.replace('fa-solid', 'fa-regular');
                    this.showToast("Removed from Liked Songs");
                } else {
                    this.likedSongs.push(track.id);
                    this.btnLike.classList.add('liked'); this.likeIcon.classList.replace('fa-regular', 'fa-solid');
                    this.showToast("Added to Liked Songs");
                }
                localStorage.setItem('glassBeatLiked', JSON.stringify(this.likedSongs));
                if(window.location.hash === '#liked') this.handleRoute(); // Refresh if on liked view
            }

            // --- QUEUE & RIGHT SIDEBAR ---
            renderQueueList() {
                this.queueList.innerHTML = '';
                const start = this.currentIndex + 1;
                for(let i = 0; i < Math.min(5, this.queue.length - start); i++) {
                    const idx = start + i;
                    const t = this.queue[idx];
                    const item = document.createElement('div');
                    item.className = 'queue-item';
                    item.draggable = true;
                    item.dataset.index = idx;
                    item.onclick = () => this.playTrack(idx);
                    item.innerHTML = `
                        <img src="${t.cover}" class="queue-item-img">
                        <div style="flex:1; min-width:0;">
                            <div class="truncate" style="font-size:13px; font-weight:500;">${t.title}</div>
                            <div class="truncate" style="font-size:11px; color:var(--text-muted);">${t.artist}</div>
                        </div>
                    `;
                    this.queueList.appendChild(item);
                }
            }

            // --- EVENTS & UTILS ---
            setupEventListeners() {
                this.audio.addEventListener('timeupdate', () => this.updateProgressUI());
                this.audio.addEventListener('ended', () => { if (this.repeatMode !== 2) this.nextTrack(); });
                
                // Search Event
                this.searchInput.addEventListener('input', (e) => {
                    if(window.location.hash !== '#search') window.location.hash = 'search';
                    this.renderSearch(this.viewContainer.querySelector('.view-section'), e.target.value);
                });

                // Seek
                let dragSeek = false;
                this.progSlider.addEventListener('mousedown', (e) => { dragSeek = true; this.handleSeek(e, true); });
                window.addEventListener('mousemove', (e) => { if(dragSeek) this.handleSeek(e, false); });
                window.addEventListener('mouseup', () => { if(dragSeek) dragSeek = false; });

                // Vol
                let dragVol = false;
                this.volSlider.addEventListener('mousedown', (e) => { dragVol = true; this.handleVolume(e, true); });
                window.addEventListener('mousemove', (e) => { if(dragVol) this.handleVolume(e, true); });
                window.addEventListener('mouseup', () => { if(dragVol) dragVol = false; });
                
                // Keyboard
                document.addEventListener('keydown', (e) => {
                    if(e.target.tagName === 'INPUT') return;
                    if(e.code === 'Space') { e.preventDefault(); this.togglePlay(); }
                });

                // Mobile Sidebar Click Outside Logic
                document.addEventListener('click', (e) => {
                    const sidebar = document.querySelector('.sidebar-left');
                    const menuBtn = document.querySelector('.mobile-menu-btn');
                    if(window.innerWidth <= 768 && sidebar && sidebar.classList.contains('show-mobile')) {
                        // Close sidebar if user clicks outside of it and outside the hamburger button
                        if(!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                            sidebar.classList.remove('show-mobile');
                        }
                    }
                });
            }

            updateProgressUI() {
                if(isNaN(this.audio.duration)) return;
                const pct = (this.audio.currentTime / this.audio.duration) * 100;
                document.getElementById('progress-fill').style.width = `${pct}%`;
                document.getElementById('progress-thumb').style.left = `${pct}%`;
                document.getElementById('time-current').textContent = this.formatTime(this.audio.currentTime);
                document.getElementById('time-total').textContent = this.formatTime(this.audio.duration);
            }

            handleSeek(e, apply) {
                const r = this.progSlider.getBoundingClientRect();
                let p = Math.max(0, Math.min(1, (e.clientX - r.left) / r.width));
                document.getElementById('progress-fill').style.width = `${p*100}%`;
                document.getElementById('progress-thumb').style.left = `${p*100}%`;
                if(apply && !isNaN(this.audio.duration)) this.audio.currentTime = p * this.audio.duration;
            }

            handleVolume(e, apply) {
                const r = this.volSlider.getBoundingClientRect();
                let p = Math.max(0, Math.min(1, (e.clientX - r.left) / r.width));
                if(apply) {
                    this.volume = p; this.audio.volume = p;
                    this.updateVolumeUI(); localStorage.setItem('glassBeatVol', p);
                }
            }

            updateVolumeUI() {
                document.getElementById('volume-fill').style.width = `${this.volume*100}%`;
                document.getElementById('volume-thumb').style.left = `${this.volume*100}%`;
                const vi = document.getElementById('volume-icon');
                if(this.volume === 0) vi.className = 'fa-solid fa-volume-xmark';
                else if(this.volume < 0.5) vi.className = 'fa-solid fa-volume-low';
                else vi.className = 'fa-solid fa-volume-high';
            }

            toggleMute() {
                if(this.audio.volume > 0) { this.audio.volume = 0; document.getElementById('volume-fill').style.width='0%'; document.getElementById('volume-icon').className='fa-solid fa-volume-xmark';}
                else { this.audio.volume = this.volume || 1; this.updateVolumeUI(); }
            }

            loadSettings() {
                const v = localStorage.getItem('glassBeatVol');
                if(v !== null) { this.volume = parseFloat(v); this.audio.volume = this.volume; this.updateVolumeUI(); }
            }

            formatTime(s) {
                if(isNaN(s)) return "0:00";
                const m = Math.floor(s/60); const secs = Math.floor(s%60);
                return `${m}:${secs<10?'0':''}${secs}`;
            }

            showToast(msg) {
                const c = document.getElementById('toast-container');
                const t = document.createElement('div'); t.className = 'toast';
                t.innerHTML = `<i class="fa-solid fa-check" style="color:var(--primary); margin-right:8px;"></i> ${msg}`;
                c.appendChild(t);
                setTimeout(() => { if(t.parentNode) t.parentNode.removeChild(t); }, 3000);
            }

            startVisualizer() {
                if(this.visAnimationId) return;
                const bars = document.querySelectorAll('.visualizer-mini .bar');
                const anim = () => {
                    if(!this.isPlaying) return;
                    bars.forEach(b => b.style.height = `${Math.floor(Math.random()*90)+10}%`);
                    this.visAnimationId = setTimeout(() => requestAnimationFrame(anim), 100);
                }; anim();
            }
            stopVisualizer() {
                clearTimeout(this.visAnimationId); this.visAnimationId = null;
                document.querySelectorAll('.visualizer-mini .bar').forEach(b => b.style.height='15%');
            }
        }

        // Particle background (60fps minimal load)
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        
        for(let i=0; i<60; i++) {
            particles.push({
                x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*2+1,
                sx: (Math.random()-0.5)*0.5, sy: (Math.random()-0.5)*0.5-0.2,
                color: ['rgba(0,217,255,0.3)','rgba(107,0,255,0.3)','rgba(255,0,255,0.2)'][Math.floor(Math.random()*3)]
            });
        }
        function drawP() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach(p => {
                p.x += p.sx; p.y += p.sy;
                if(p.y<0) p.y=canvas.height; if(p.x<0) p.x=canvas.width; if(p.x>canvas.width) p.x=0;
                ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(drawP);
        } drawP();

        // Boot
        window.app = new MusicPlayerSPA();
    </script>
</body>
</html>